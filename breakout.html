<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä½œ ãƒ–ãƒ­ãƒƒã‚¯å´©ã—</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #1a1a2e; /* ãƒ€ãƒ¼ã‚¯ãªèƒŒæ™¯ */
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #ffcc00;
            margin-bottom: 20px;
        }
        #gameCanvas {
            background: linear-gradient(to top, #0f0f1b, #1a1a2e); /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1), inset 0 0 5px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }
        #scoreDisplay {
            margin-top: 15px;
            font-size: 1.5em;
            color: #00ff99;
            font-weight: bold;
        }
        #message {
            margin-top: 20px;
            font-size: 1.8em;
            color: #ff6666;
            font-weight: bold;
            min-height: 30px;
        }
        #startButton, #resetButton {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            transition: background-color 0.2s, transform 0.1s;
        }
        #startButton:hover, #resetButton:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        /* --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®æ±ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #backToMenu {
            position: fixed; 
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: background-color 0.2s;
        }
        #backToMenu:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <h1>ğŸ§± AIä½œ ãƒ–ãƒ­ãƒƒã‚¯å´©ã— ğŸ§±</h1>
    <canvas id="gameCanvas" width="480" height="320"></canvas>
    <div id="scoreDisplay">ã‚¹ã‚³ã‚¢: 0 | ãƒ©ã‚¤ãƒ•: 3</div>
    <div id="message">ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§é–‹å§‹</div>
    <button id="startButton" style="display: none;">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    <button id="resetButton" style="display: none;">ã‚‚ã†ä¸€åº¦éŠã¶</button>

    <button id="backToMenu">ğŸ¡ ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>

    <script>
        // --- è¨­å®š ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        const PADDLE_HEIGHT = 10;
        let paddleWidth = 75; // å¤‰æ›´å¯èƒ½ã«ã™ã‚‹
        const BALL_RADIUS = 5;
        const BRICK_ROW_COUNT = 3;
        const BRICK_COLUMN_COUNT = 5;
        const BRICK_WIDTH = 75;
        const BRICK_HEIGHT = 20;
        const BRICK_PADDING = 10;
        const BRICK_OFFSET_TOP = 30;
        const BRICK_OFFSET_LEFT = 30;

        // --- å¤‰æ•° ---
        let paddleX = (W - paddleWidth) / 2;
        let ballX, ballY, dx, dy;
        let score = 0;
        let lives = 3;
        let gameActive = false;
        let powerUpActive = false;
        let powerUpTimer = null;
        let bricks = [];
        let animationFrameId;

        // --- DOMè¦ç´  ---
        const scoreDisplay = document.getElementById('scoreDisplay');
        const messageDisplay = document.getElementById('message');
        const startButton = document.getElementById('startButton');
        const resetButton = document.getElementById('resetButton');
        const backToMenuButton = document.getElementById('backToMenu');

        // --- åˆæœŸåŒ– ---
        initBricks();
        resetBallAndPaddle();

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        document.addEventListener("mousemove", mouseMoveHandler, false);
        document.addEventListener("click", clickHandler, false);
        document.addEventListener("keydown", keyDownHandler, false);
        resetButton.addEventListener('click', resetGame);
        backToMenuButton.addEventListener('click', () => {
            cancelAnimationFrame(animationFrameId); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åœæ­¢
            window.location.href = 'index.html';
        });

        // --- é–¢æ•°å®šç¾© ---

        function initBricks() {
            bricks = [];
            for (let c = 0; c < BRICK_COLUMN_COUNT; c++) {
                bricks[c] = [];
                for (let r = 0; r < BRICK_ROW_COUNT; r++) {
                    // å„ãƒ–ãƒ­ãƒƒã‚¯ã«è€ä¹…åº¦ (1ï½3) ã‚’è¨­å®š
                    bricks[c][r] = { x: 0, y: 0, status: Math.floor(Math.random() * 3) + 1 }; 
                }
            }
        }

        function resetBallAndPaddle() {
            paddleWidth = 75; // ãƒãƒ¼ã®å¹…ã‚’ãƒªã‚»ãƒƒãƒˆ
            paddleX = (W - paddleWidth) / 2;
            ballX = W / 2;
            ballY = H - 30;
            dx = 2; // Xæ–¹å‘ã®é€Ÿåº¦
            dy = -2; // Yæ–¹å‘ã®é€Ÿåº¦
        }

        function resetGame() {
            cancelAnimationFrame(animationFrameId);
            initBricks();
            resetBallAndPaddle();
            score = 0;
            lives = 3;
            gameActive = false;
            updateScoreDisplay();
            messageDisplay.textContent = "ç”»é¢ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§é–‹å§‹";
            resetButton.style.display = 'none';
        }

        function startGame() {
            if (gameActive) return;
            gameActive = true;
            messageDisplay.textContent = "";
            gameLoop();
        }
        
        // requestAnimationFrame ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ ãƒ¼ã‚ºãªæç”»
        function gameLoop() {
            ctx.clearRect(0, 0, W, H);
            
            drawBricks();
            drawBall();
            drawPaddle();
            moveBall();
            
            collisionDetection();
            
            // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è¦æ±‚
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function mouseMoveHandler(e) {
            const relativeX = e.clientX - canvas.offsetLeft;
            if (relativeX > 0 && relativeX < W) {
                paddleX = relativeX - paddleWidth / 2;
                // ç”»é¢ç«¯ã®åˆ¶é™
                if (paddleX < 0) paddleX = 0;
                if (paddleX + paddleWidth > W) paddleX = W - paddleWidth;
            }
        }

        function clickHandler(e) {
            startGame();
        }

        function keyDownHandler(e) {
            if (e.code === "Space") {
                e.preventDefault();
                startGame();
            }
        }

        function drawBall() {
            ctx.beginPath();
            ctx.arc(ballX, ballY, BALL_RADIUS, 0, Math.PI * 2);
            // ãƒœãƒ¼ãƒ«ã«å½±ã‚’ã¤ã‘ã¦ç«‹ä½“æ„Ÿã‚’å‡ºã™
            ctx.fillStyle = "#fff";
            ctx.shadowBlur = 5;
            ctx.shadowColor = "#00ff99";
            ctx.fill();
            ctx.shadowBlur = 0; // å½±ã‚’ãƒªã‚»ãƒƒãƒˆ
            ctx.closePath();
        }

        function drawPaddle() {
            ctx.beginPath();
            ctx.rect(paddleX, H - PADDLE_HEIGHT, paddleWidth, PADDLE_HEIGHT);
            // ãƒ‘ãƒ‰ãƒ«ã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨ã—ã¦è³ªæ„Ÿã‚’å‡ºã™
            const gradient = ctx.createLinearGradient(paddleX, H - PADDLE_HEIGHT, paddleX + paddleWidth, H);
            gradient.addColorStop(0, "#ff9900");
            gradient.addColorStop(1, "#cc6600");
            ctx.fillStyle = gradient;
            ctx.fill();
            ctx.closePath();
        }

        function drawBricks() {
            for (let c = 0; c < BRICK_COLUMN_COUNT; c++) {
                for (let r = 0; r < BRICK_ROW_COUNT; r++) {
                    const brick = bricks[c][r];
                    if (brick.status > 0) {
                        const brickX = (c * (BRICK_WIDTH + BRICK_PADDING)) + BRICK_OFFSET_LEFT;
                        const brickY = (r * (BRICK_HEIGHT + BRICK_PADDING)) + BRICK_OFFSET_TOP;
                        brick.x = brickX;
                        brick.y = brickY;

                        ctx.beginPath();
                        ctx.rect(brickX, brickY, BRICK_WIDTH, BRICK_HEIGHT);

                        // ãƒ–ãƒ­ãƒƒã‚¯ã®è€ä¹…åº¦ã«å¿œã˜ã¦è‰²ã‚’å¤‰ãˆã‚‹
                        let color;
                        switch (brick.status) {
                            case 3: color = "#ff4d4d"; break; // èµ¤ (é«˜è€ä¹…)
                            case 2: color = "#ff9933"; break; // ã‚ªãƒ¬ãƒ³ã‚¸ (ä¸­è€ä¹…)
                            case 1: color = "#ffff66"; break; // é»„è‰² (ä½è€ä¹…)
                            default: color = "#ffffff";
                        }

                        // ãƒ–ãƒ­ãƒƒã‚¯ã«å½±ã¨ç«‹ä½“æ„Ÿ
                        ctx.fillStyle = color;
                        ctx.shadowColor = "rgba(0, 0, 0, 0.8)";
                        ctx.shadowBlur = 4;
                        ctx.shadowOffsetX = 2;
                        ctx.shadowOffsetY = 2;
                        
                        ctx.fill();
                        
                        // å½±ã‚’ãƒªã‚»ãƒƒãƒˆ
                        ctx.shadowBlur = 0;
                        ctx.shadowOffsetX = 0;
                        ctx.shadowOffsetY = 0;
                        
                        // æ ç·šã‚’è¿½åŠ ã—ã¦è¦–èªæ€§ã‚’ä¸Šã’ã‚‹
                        ctx.strokeStyle = "#333";
                        ctx.lineWidth = 1;
                        ctx.stroke();
                        
                        ctx.closePath();
                    }
                }
            }
        }
        
        function moveBall() {
            ballX += dx;
            ballY += dy;

            // å£ã¨ã®è¡çªåˆ¤å®š
            if (ballX + dx > W - BALL_RADIUS || ballX + dx < BALL_RADIUS) {
                dx = -dx;
            }
            if (ballY + dy < BALL_RADIUS) {
                dy = -dy;
            } else if (ballY + dy > H - BALL_RADIUS) {
                // ãƒ‘ãƒ‰ãƒ«ã¨ã®è¡çªåˆ¤å®š
                if (ballX > paddleX && ballX < paddleX + paddleWidth) {
                    // Yæ–¹å‘ã®åè»¢
                    dy = -dy;
                    // ãƒ‘ãƒ‰ãƒ«ã®ç«¯ã«å½“ãŸã‚‹ã¨Xæ–¹å‘ã®é€Ÿåº¦ãŒå¤‰åŒ–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ (ã‚ˆã‚Šãƒªã‚¢ãƒ«ãªå‹•ã)
                    const hitPoint = ballX - (paddleX + paddleWidth / 2);
                    dx = hitPoint * 0.15; // ä¸­å¤®ã‹ã‚‰é›¢ã‚Œã‚‹ã»ã©Xé€Ÿåº¦ã‚¢ãƒƒãƒ—
                } else {
                    // ãƒœãƒ¼ãƒ«ã‚’è½ã¨ã—ãŸ
                    lives--;
                    updateScoreDisplay();
                    if (lives === 0) {
                        gameOver();
                    } else {
                        // 1ãƒŸã‚¹å¾Œã€ãƒœãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                        resetBallAndPaddle();
                        messageDisplay.textContent = "ãƒŸã‚¹ï¼æ®‹ã‚Š " + lives + " ãƒ©ã‚¤ãƒ•ã€‚ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã§å†é–‹ã€‚";
                        gameActive = false;
                    }
                }
            }
        }
        
        function collisionDetection() {
            for (let c = 0; c < BRICK_COLUMN_COUNT; c++) {
                for (let r = 0; r < BRICK_ROW_COUNT; r++) {
                    const b = bricks[c][r];
                    if (b.status > 0) {
                        if (ballX > b.x && ballX < b.x + BRICK_WIDTH && ballY > b.y && ballY < b.y + BRICK_HEIGHT) {
                            // è¡çªï¼
                            dy = -dy; // Yæ–¹å‘ã‚’åè»¢

                            b.status--; // è€ä¹…åº¦ã‚’æ¸›ã‚‰ã™
                            score += 10;
                            updateScoreDisplay();

                            // ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‰ãƒ­ãƒƒãƒ— (è€ä¹…åº¦3ã®ãƒ–ãƒ­ãƒƒã‚¯ãŒå£Šã‚ŒãŸã‚‰ä¸€å®šç¢ºç‡ã§ãƒ‰ãƒ­ãƒƒãƒ—)
                            if (b.status === 0 && Math.random() < 0.2) { // 20%ã®ç¢ºç‡
                                activatePowerUp();
                            }

                            if (checkWin()) {
                                gameWin();
                            }
                            return; // 1ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ã«ã—ã‹å½“ãŸã‚‰ãªã„å‰æ
                        }
                    }
                }
            }
        }
        
        function activatePowerUp() {
            if (powerUpActive) {
                clearTimeout(powerUpTimer);
            }
            
            const originalPaddleWidth = paddleWidth;
            paddleWidth = 120; // ãƒãƒ¼ã®å¹…ã‚’æ‹¡å¼µ
            powerUpActive = true;
            messageDisplay.textContent = "â­ ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ï¼ãƒãƒ¼ãŒä¼¸ã³ãŸï¼ â­";

            powerUpTimer = setTimeout(() => {
                paddleWidth = originalPaddleWidth; // å…ƒã«æˆ»ã™
                powerUpActive = false;
                messageDisplay.textContent = "ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—çµ‚äº†";
            }, 8000); // 8ç§’é–“æŒç¶š
        }
        
        function checkWin() {
            for (let c = 0; c < BRICK_COLUMN_COUNT; c++) {
                for (let r = 0; r < BRICK_ROW_COUNT; r++) {
                    if (bricks[c][r].status > 0) {
                        return false;
                    }
                }
            }
            return true;
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score} | ãƒ©ã‚¤ãƒ•: ${lives}`;
        }

        function gameOver() {
            cancelAnimationFrame(animationFrameId);
            gameActive = false;
            messageDisplay.textContent = `ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}`;
            resetButton.style.display = 'block';
        }

        function gameWin() {
            cancelAnimationFrame(animationFrameId);
            gameActive = false;
            messageDisplay.textContent = `ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}`;
            resetButton.style.display = 'block';
        }
    </script>
</body>
</html>
