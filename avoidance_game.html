<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä½œ éšœå®³ç‰©é¿ã‘ã‚²ãƒ¼ãƒ </title>
    <style>
        /* ä¿®æ­£æ¸ˆã¿ã®CSSã‚’ã“ã“ã«é…ç½® */
        body { 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            background-color: #f0f8ff; 
            margin: 0;
            padding: 20px;
        }
        .game-container {
            background-color: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        #myCanvas {
            border: 2px solid #333;
            background-color: #fafafa;
            display: block;
        }
        #game-info {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #333;
        }
        #message {
            font-size: 1.5em;
            font-weight: bold;
            color: #dc3545;
            margin-top: 10px;
        }
        #startButton {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 15px;
        }
        /* --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®æ±ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #backToMenu {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: background-color 0.2s;
        }
        #backToMenu:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>AIä½œ éšœå®³ç‰©é¿ã‘ã‚²ãƒ¼ãƒ </h1>
        <p>å·¦å³ã®çŸ¢å°ã‚­ãƒ¼ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆé’ã„ãƒ–ãƒ­ãƒƒã‚¯ï¼‰ã‚’å‹•ã‹ã—ã¦ã€ä¸Šã‹ã‚‰è½ã¡ã¦ãã‚‹èµ¤ã„ãƒ–ãƒ­ãƒƒã‚¯ã‚’é¿ã‘ç¶šã‘ã‚ˆã†ï¼</p>
        <div id="game-info">
            ã‚¹ã‚³ã‚¢: <span id="scoreDisplay">0</span>
        </div>
        <canvas id="myCanvas" width="400" height="400"></canvas>
        <div id="message"></div>
        <button id="startButton">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    </div>
    <button id="backToMenu">ğŸ¡ ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const messageDisplay = document.getElementById('message');
        const startButton = document.getElementById('startButton');

        // --- ã‚²ãƒ¼ãƒ å®šæ•° ---
        const PLAYER_SIZE = 20;
        const PLAYER_SPEED = 5;
        const OBSTACLE_SIZE = 25;
        const OBSTACLE_SPEED = 2;
        const SPAWN_INTERVAL = 80;

        // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ---
        let playerX = canvas.width / 2 - PLAYER_SIZE / 2;
        let playerY = canvas.height - PLAYER_SIZE - 10;
        let score = 0;
        let obstacles = [];
        let rightPressed = false;
        let leftPressed = false;
        let gameActive = false;
        let frameCount = 0;
        let animationFrameId; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³IDã‚’å®šç¾©

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        document.addEventListener('keydown', keyDownHandler, false);
        document.addEventListener('keyup', keyUpHandler, false);
        startButton.addEventListener('click', startGame, false);

        function keyDownHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = true;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = true;
            }
        }

        function keyUpHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = false;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = false;
            }
        }

        // --- æç”»é–¢æ•° ---
        function drawPlayer() {
            ctx.beginPath();
            ctx.rect(playerX, playerY, PLAYER_SIZE, PLAYER_SIZE);
            ctx.fillStyle = '#007bff';
            ctx.fill();
            ctx.closePath();
        }

        function drawObstacles() {
            ctx.fillStyle = '#dc3545';
            obstacles.forEach(obs => {
                ctx.beginPath();
                ctx.rect(obs.x, obs.y, OBSTACLE_SIZE, OBSTACLE_SIZE);
                ctx.fill();
                ctx.closePath();
            });
        }

        function spawnObstacle() {
            const obsX = Math.random() * (canvas.width - OBSTACLE_SIZE);
            obstacles.push({ x: obsX, y: 0 });
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateGame() {
            if (rightPressed && playerX < canvas.width - PLAYER_SIZE) {
                playerX += PLAYER_SPEED;
            } else if (leftPressed && playerX > 0) {
                playerX -= PLAYER_SPEED;
            }

            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obs = obstacles[i];
                obs.y += OBSTACLE_SPEED;

                // è¡çªåˆ¤å®š
                if (
                    playerX < obs.x + OBSTACLE_SIZE &&
                    playerX + PLAYER_SIZE > obs.x &&
                    playerY < obs.y + OBSTACLE_SIZE &&
                    playerY + PLAYER_SIZE > obs.y
                ) {
                    gameOver();
                    return;
                }

                if (obs.y > canvas.height) {
                    obstacles.splice(i, 1);
                    score++;
                    scoreDisplay.textContent = score;
                }
            }

            if (frameCount % SPAWN_INTERVAL === 0) {
                spawnObstacle();
            }
            frameCount++;
        }

        // --- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ— ---
        function draw() {
            if (!gameActive) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            updateGame();
            drawPlayer();
            drawObstacles();

            animationFrameId = requestAnimationFrame(draw);
        }

        function startGame() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            playerX = canvas.width / 2 - PLAYER_SIZE / 2;
            score = 0;
            obstacles = [];
            frameCount = 0;
            scoreDisplay.textContent = score;
            messageDisplay.textContent = '';
            startButton.style.display = 'none';
            gameActive = true;
            
            draw();
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(animationFrameId);
            messageDisplay.textContent = `ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ã‚¹ã‚³ã‚¢: ${score} ç‚¹`;
            startButton.textContent = 'ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤';
            startButton.style.display = 'block';
        }
        
        // åˆæœŸè¡¨ç¤º
        ctx.fillStyle = '#333';
        ctx.font = '20px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', canvas.width / 2, canvas.height / 2);
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼é·ç§»ãƒ­ã‚¸ãƒƒã‚¯
        const backToMenuButton = document.getElementById('backToMenu');
        backToMenuButton.addEventListener('click', () => {
            if (typeof cancelAnimationFrame !== 'undefined' && animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            window.location.href = 'index.html';
        });
        
    </script>

</body>

</html>
